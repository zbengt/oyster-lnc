---
title: "02-kallisto-merge"
author: "Zach Bengtsson"
---

```{r}
setwd("~/github/oyster-lnc/output/01-lncRNA-kallisto")
getwd()

folders <- list.files(pattern = "S\\d+[FM]$")
print(folders)
```
```{r}
install.packages("ghql")
getwd()
```

```{r}
count_matrix <- NULL
for (folder in folders) {
  # set the working directory to the current folder
  setwd(paste0("/home/shared/8TB_HDD_02/zbengt/github/oyster-lnc/output/01-lncRNA-kallisto/", folder))
  
  # read in the abundance data
  data <- read.table("abundance.tsv", header = TRUE, sep = "\t")
  
  # add the abundance data to the count matrix
  count_matrix <- cbind(count_matrix, data[, "est_counts"])
}

print(count_matrix)
```
```{r}
rownames(count_matrix) <- data[, "target_id"]
colnames(count_matrix) <- gsub(".*/", "", folders)
print(count_matrix)
```

```{r}
setwd("/home/shared/8TB_HDD_02/zbengt/github/oyster-lnc/output/01-lncRNA-kallisto")
write.table(count_matrix, "merged_counts.txt", sep = "\t", quote = FALSE)
```

```{r}
setwd("/home/shared/8TB_HDD_02/zbengt/github/oyster-lnc/output/01-lncRNA-kallisto")
write.csv(count_matrix, file = "merged_counts.csv", row.names = TRUE)
```

